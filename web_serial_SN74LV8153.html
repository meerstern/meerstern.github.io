<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SN74LV8153 Test Tool</title>
	<style>
			h1 { font-size:20pt; background-color:#4F4F4F; color:#FFFFFF; font-weight : normal;}
			h2 { font-size:16pt; }
			h3 { font-size:8pt; }
			fieldset { font-size:12pt; line-height:0.1em; padding:  20px;}
			body { font-size:12pt; color:#444444; }
			footer{ font-size:4pt; }			
	</style>
  </head>
  <body>
	<h1><span>SN74LV8153 Test Tool</span></h1>
	<h2><span id="msg_string" >This tool enables to control SN74LV8153 through UART.</span></h2>
	
	<fieldset>    
	<legend>Address</legend>	
	<div>
	  <p>A2/A1/A0</p>　　
      <input type="radio" id="Addr000" name="Addr" value="000" checked onchange="AddrChange();">
      <label for="Addr000">0/0/0</label>
      <input type="radio" id="Addr001" name="Addr" value="001" onchange="AddrChange();">
      <label for="Addr001">0/0/1</label>
	  <input type="radio" id="Addr010" name="Addr" value="010" onchange="AddrChange();">
      <label for="Addr010">0/1/0</label>
	  <input type="radio" id="Addr011" name="Addr" value="011" onchange="AddrChange();">
      <label for="Addr011">0/1/1</label>
	  <input type="radio" id="Addr100" name="Addr" value="100" onchange="AddrChange();">
      <label for="Addr100">1/0/0</label>
	  <input type="radio" id="Addr101" name="Addr" value="101" onchange="AddrChange();">
      <label for="Addr101">1/0/1</label>
	  <input type="radio" id="Addr110" name="Addr" value="110" onchange="AddrChange();">
      <label for="Addr110">1/1/0</label>
	  <input type="radio" id="Addr111" name="Addr" value="111" onchange="AddrChange();">
      <label for="Addr111">1/1/1</label>
	</div>	
	</fieldset>
	
	<br/>
	<fieldset>    
	<legend>GPIO ON/OFF</legend>	
	<div>
	  <p>GPIO0</p>　　
      <input type="radio" id="off0" name="sw0" value="off0" checked disabled onchange="IOChange();">
      <label for="off0">OFF</label>
      <input type="radio" id="on0" name="sw0" value="on0" disabled onchange="IOChange();">
      <label for="on0">ON</label>
	</div>	
	<div>
	　　<p>GPIO1</p>　　
      <input type="radio" id="off1" name="sw1" value="off1" checked disabled onchange="IOChange();">
      <label for="off1">OFF</label>
      <input type="radio" id="on1" name="sw1" value="on1" disabled onchange="IOChange();">
      <label for="on1">ON</label>
	</div>	
	<div>
	　　<p>GPIO2</p>　　
      <input type="radio" id="off2" name="sw2" value="off2" checked disabled onchange="IOChange();">
      <label for="off2">OFF</label>
      <input type="radio" id="on2" name="sw2" value="on2" disabled onchange="IOChange();">
      <label for="on2">ON</label>
	</div>	
	<div>
	　　<p>GPIO3</p>　　
      <input type="radio" id="off3" name="sw3" value="off3" checked disabled onchange="IOChange();">
      <label for="off3">OFF</label>
      <input type="radio" id="on3" name="sw3" value="on3" disabled onchange="IOChange();">
      <label for="on3">ON</label>
	</div>	
	<div>
	　　<p>GPIO4</p>　　
      <input type="radio" id="off4" name="sw4" value="off4" checked disabled onchange="IOChange();">
      <label for="off4">OFF</label>
      <input type="radio" id="on4" name="sw4" value="on4" disabled onchange="IOChange();">
      <label for="on4">ON</label>
	</div>	
	<div>
	　　<p>GPIO5</p>　　
      <input type="radio" id="off5" name="sw5" value="off5" checked disabled onchange="IOChange();">
      <label for="off5">OFF</label>
      <input type="radio" id="on5" name="sw5" value="on5" disabled onchange="IOChange();">
      <label for="on5">ON</label>
	</div>	
	<div>
	　　<p>GPIO6</p>　　
      <input type="radio" id="off6" name="sw6" value="off6" checked disabled onchange="IOChange();">
      <label for="off6">OFF</label>
      <input type="radio" id="on6" name="sw6" value="on6" disabled onchange="IOChange();">
      <label for="on6">ON</label>
	</div>	
	<div>
	　　<p>GPIO7</p>　　
      <input type="radio" id="off7" name="sw7" value="off7" checked disabled onchange="IOChange();">
      <label for="off7">OFF</label>
      <input type="radio" id="on7" name="sw7" value="on7" disabled onchange="IOChange();">
      <label for="on7">ON</label>
	</div>	
	</fieldset>
	<br/>
	<button id="connect-button" type="button" disabled>Connect</button>
	<h3>
		<span>
		This tool is for <a href="https://www.ti.com/product/en-us/SN74LV8153">SN74LV8153</a> with UART & Browzer.</span>
	</h3>
	<h3><span>Works offline & Local environment</span></h3>
	<h3><span>Edge or Chrome only</span></h3>
	<footer>
	<p>Copyright (c) 2025 Crescent All Rights Reserved.</p>
	</footer>
	
	<script>
	/*	GPIO Tool
	 *	Copyright (c) 2025
	 *  K.Watanabe,Crescent
	 *  Released under the MIT license
	 *  http://opensource.org/licenses/mit-license.php
	 */
	const connectButton = document.getElementById ('connect-button');

	
	const addr000 = document.getElementById("Addr000");
	const addr001 = document.getElementById("Addr001");
	const addr010 = document.getElementById("Addr010");
	const addr011 = document.getElementById("Addr011");
	const addr100 = document.getElementById("Addr100");
	const addr101 = document.getElementById("Addr101");
	const addr110 = document.getElementById("Addr110");
	const addr111 = document.getElementById("Addr111");
	
	const off0 = document.getElementById("off0");
	const off1 = document.getElementById("off1");
	const off2 = document.getElementById("off2");
	const off3 = document.getElementById("off3");
	const off4 = document.getElementById("off4");
	const off5 = document.getElementById("off5");
	const off6 = document.getElementById("off6");
	const off7 = document.getElementById("off7");
	
	const on0 = document.getElementById("on0");
	const on1 = document.getElementById("on1");
	const on2 = document.getElementById("on2");
	const on3 = document.getElementById("on3");
	const on4 = document.getElementById("on4");
	const on5 = document.getElementById("on5");
	const on6 = document.getElementById("on6");
	const on7 = document.getElementById("on7");
	
	let port;
	let dataIndex = 0;
	let addr = 0;
	let str = "";
	let closed;	
	let io_state = 0;
	
	//Wait Function
	function Sleep( milli_second )
	{
		var start = new Date();
		while( new Date() - start < milli_second );
	}
	
	function disableButton(dis)
	{
		off0.disabled = dis;
		off1.disabled = dis;
		off2.disabled = dis;
		off3.disabled = dis;
		off4.disabled = dis;
		off5.disabled = dis;
		off6.disabled = dis;
		off7.disabled = dis;
		on0.disabled = dis;
		on1.disabled = dis;
		on2.disabled = dis;
		on3.disabled = dis;
		on4.disabled = dis;
		on5.disabled = dis;
		on6.disabled = dis;
		on7.disabled = dis;
	}
	
	//Address Changed Event
	async function AddrChange()
	{	
		
		if(addr000.checked==true)
		{
			addr = 0b000;		
		}
		else if(addr001.checked==true)
		{			
			addr = 0b001;	
		}
		else if(addr010.checked==true)
		{			
			addr = 0b010;	
		}
		else if(addr011.checked==true)
		{			
			addr = 0b011;	
		}
		else if(addr100.checked==true)
		{			
			addr = 0b100;	
		}
		else if(addr101.checked==true)
		{			
			addr = 0b101;	
		}
		else if(addr110.checked==true)
		{			
			addr = 0b110;	
		}
		else if(addr111.checked==true)
		{			
			addr = 0b111;	
		}
		sendData();
    }
	
	//Set State
	async function IOChange()
	{
          
		  
		if (port && port.writable)
		{
			if(off0.checked==true)
				io_state = io_state & ~(1 << 0);
			else
				io_state = io_state | (1 << 0);

			if(off1.checked==true)
				io_state = io_state & ~(1 << 1);
			else
				io_state = io_state | (1 << 1);			

			if(off2.checked==true)
				io_state = io_state & ~(1 << 2);
			else
				io_state = io_state | (1 << 2);
				
			if(off3.checked==true)
				io_state = io_state & ~(1 << 3);
			else
				io_state = io_state | (1 << 3);
				
			if(off4.checked==true)
				io_state = io_state & ~(1 << 4);
			else
				io_state = io_state | (1 << 4);
				
			if(off5.checked==true)
				io_state = io_state & ~(1 << 5);
			else
				io_state = io_state | (1 << 5);

			if(off6.checked==true)
				io_state = io_state & ~(1 << 6);
			else
				io_state = io_state | (1 << 6);
				
			if(off7.checked==true)
				io_state = io_state & ~(1 << 7);
			else
				io_state = io_state | (1 << 7);
		  
            sendData();
		}
	}
	
	async function sendData()
	{
		if (port && port.writable)
		{			
			const bytes = new Uint8Array([0x01, 0x01]);
			bytes[0] = bytes[0] + (addr<<1) +((io_state&0x0F)<<4);
			bytes[1] = bytes[1] + (addr<<1) +((io_state&0xF0)<<0);
            const writer = port.writable.getWriter();
            writer.write(bytes);
			//console.log(bytes);
            writer.releaseLock();
		}
	
	}
	
	
	//Com Open & Recieve Data
	async function getReader()
	{
        port = await navigator.serial.requestPort({});
		if ( !port.writable)
			await port.open({ baudRate: 9600 });
		
        connectButton.innerText = 'Disconnect';	
		disableButton(false);
        sendData();
    }
	  
	if ('serial' in navigator)
	{
		connectButton.addEventListener('click', async ()=>
		{
			if (port)
			{
				connectButton.innerText = 'Connect';
				disableButton(true);
				await closed;
				port = undefined;
			}
			else
			{
				closed = getReader();
			}
		});
		connectButton.disabled = false;	
	}
	else
	{
		alert('Your browzer is not supported. Please use Edge or chrome.');
	}


	</script>
  </body>
</html>
